# We only add HTTPS listener because httpd.conf already includes Listen 80
Listen 443

# Redirect all HTTP traffic to HTTPS
<VirtualHost *:80>
    ServerName buildprocure.com
    Redirect permanent / https://buildprocure.com/
</VirtualHost>

<VirtualHost *:443>
    ServerName buildprocure.com
    ServerAlias localhost
    DocumentRoot /var/www/html

    SSLEngine on
    SSLCertificateFile "/usr/local/apache2/conf/ssl/buildprocure.com_combined.crt"
    SSLCertificateKeyFile "/usr/local/apache2/conf/ssl/_.buildprocure.com_private_key.key"

    # Prevent directory listing and allow .htaccess
    <Directory /var/www/html>
        Options -Indexes +FollowSymLinks
        AllowOverride All
        Require all granted
        DirectoryIndex index.php index.html
    </Directory>

    # Send PHP requests to php-fpm container
    <FilesMatch "\.php$">
        SetHandler "proxy:fcgi://php-fpm:9000"
    </FilesMatch>

    # Forward HTTPS info to PHP for SAML and other frameworks
    RequestHeader set X-Forwarded-Proto "https"

    # Optional: Proxy SimpleSAMLphp container
    ProxyPass "/simplesaml/" "http://simplesamlphp/"
    ProxyPassReverse "/simplesaml/" "http://simplesamlphp/"

    # âœ… Fixed log paths for httpd:2.4 base image
    ErrorLog /usr/local/apache2/logs/buildprocure_error.log
    CustomLog /usr/local/apache2/logs/buildprocure_access.log combined
</VirtualHost>
